<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Full text search of Elasticsearch — Search • elastic</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Full text search of Elasticsearch — Search" />

<meta property="og:description" content="Full text search of Elasticsearch" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">elastic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/elastic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/search.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/elastic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Full text search of Elasticsearch</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/elastic/blob/master/R/search.r'><code>R/search.r</code></a></small>
    <div class="hidden name"><code>Search.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Full text search of Elasticsearch</p>
    
    </div>

    <pre class="usage"><span class='fu'>Search</span>(<span class='no'>conn</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>q</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>df</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>analyzer</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>default_operator</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>explain</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>source</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>fields</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>sort</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>track_scores</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>timeout</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>terminate_after</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>from</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>search_type</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>lowercase_expanded_terms</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>analyze_wildcard</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>version</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>lenient</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>body</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='kw'>raw</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>asdf</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>time_scroll</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>search_path</span> <span class='kw'>=</span> <span class='st'>"_search"</span>, <span class='kw'>stream_opts</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>conn</th>
      <td><p>an Elasticsearch connection object, see <code><a href='connect.html'>connect</a></code></p></td>
    </tr>
    <tr>
      <th>index</th>
      <td><p>Index name, one or more</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Document type. Note that <code>type</code> is deprecated in
Elasticsearch v7 and greater</p></td>
    </tr>
    <tr>
      <th>q</th>
      <td><p>The query string (maps to the query_string query, see Query String
Query for more details). See
https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html
for documentation and examples.</p></td>
    </tr>
    <tr>
      <th>df</th>
      <td><p>(character) The default field to use when no field prefix is
defined within the query.</p></td>
    </tr>
    <tr>
      <th>analyzer</th>
      <td><p>(character) The analyzer name to be used when analyzing the
query string.</p></td>
    </tr>
    <tr>
      <th>default_operator</th>
      <td><p>(character) The default operator to be used, can be
<code>AND</code> or <code>OR</code>. Default: <code>OR</code></p></td>
    </tr>
    <tr>
      <th>explain</th>
      <td><p>(logical) For each hit, contain an explanation of how
scoring of the hits was computed. Default: <code>FALSE</code></p></td>
    </tr>
    <tr>
      <th>source</th>
      <td><p>(logical) Set to <code>FALSE</code> to disable retrieval of the
<code>_source</code> field. You can also retrieve part of the document by
using <code>_source_include</code> &amp; <code>_source_exclude</code> (see the <code>body</code>
documentation for more details). You can also include a comma-delimited
string of fields from the source document that you want back. See also
the <strong>fields</strong> parameter</p></td>
    </tr>
    <tr>
      <th>fields</th>
      <td><p>(character) The selective stored fields of the document to
return for each hit. Not specifying any value will cause no fields to return.
Note that in Elasticsearch v5 and greater, <strong>fields</strong> parameter has
changed to <strong>stored_fields</strong>, which is not on by default. You can
however, pass fields to <strong>source</strong> parameter</p></td>
    </tr>
    <tr>
      <th>sort</th>
      <td><p>(character) Sorting to perform. Can either be in the form of
fieldName, or <code>fieldName:asc</code>/<code>fieldName:desc</code>. The fieldName
can either be an actual field within the document, or the special
<code>_score</code> name to indicate sorting based on scores. There can be several
sort parameters (order is important).</p></td>
    </tr>
    <tr>
      <th>track_scores</th>
      <td><p>(logical) When sorting, set to <code>TRUE</code> in order to
still track scores and return them as part of each hit.</p></td>
    </tr>
    <tr>
      <th>timeout</th>
      <td><p>(numeric) A search timeout, bounding the search request to
be executed within the specified time value and bail with the hits
accumulated up to that point when expired. Default: no timeout.</p></td>
    </tr>
    <tr>
      <th>terminate_after</th>
      <td><p>(numeric) The maximum number of documents to collect
for each shard, upon reaching which the query execution will terminate
early. If set, the response will have a boolean field terminated_early to
indicate whether the query execution has actually terminated_early.
Default: no terminate_after</p></td>
    </tr>
    <tr>
      <th>from</th>
      <td><p>(character) The starting from index of the hits to return.
Pass in as a character string to avoid problems with large number
conversion to scientific notation. Default: 0</p></td>
    </tr>
    <tr>
      <th>size</th>
      <td><p>(character) The number of hits to return. Pass in as a
character string to avoid problems with large number conversion to
scientific notation. Default: 10. The default maximum is 10,000 - however,
you can change this default maximum by changing the
<code>index.max_result_window</code> index level parameter.</p></td>
    </tr>
    <tr>
      <th>search_type</th>
      <td><p>(character) The type of the search operation to perform.
Can be <code>query_then_fetch</code> (default) or <code>dfs_query_then_fetch</code>.
Types <code>scan</code> and <code>count</code> are deprecated.
See <a href='http://bit.ly/19Am9xP'>http://bit.ly/19Am9xP</a> for more details on the different types of
search that can be performed.</p></td>
    </tr>
    <tr>
      <th>lowercase_expanded_terms</th>
      <td><p>(logical) Should terms be automatically
lowercased or not. Default: <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>analyze_wildcard</th>
      <td><p>(logical) Should wildcard and prefix queries be
analyzed or not. Default: <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>version</th>
      <td><p>(logical) Print the document version with each document.</p></td>
    </tr>
    <tr>
      <th>lenient</th>
      <td><p>If <code>TRUE</code> will cause format based failures (like
providing text to a numeric field) to be ignored. Default: <code>FALSE</code></p></td>
    </tr>
    <tr>
      <th>body</th>
      <td><p>Query, either a list or json.</p></td>
    </tr>
    <tr>
      <th>raw</th>
      <td><p>(logical) If <code>FALSE</code> (default), data is parsed to list.
If <code>TRUE</code>, then raw JSON returned</p></td>
    </tr>
    <tr>
      <th>asdf</th>
      <td><p>(logical) If <code>TRUE</code>, use <code><a href='https://www.rdocumentation.org/packages/jsonlite/topics/fromJSON'>fromJSON</a></code>
to parse JSON directly to a data.frame. If <code>FALSE</code> (Default), list
output is given.</p></td>
    </tr>
    <tr>
      <th>time_scroll</th>
      <td><p>(character) Specify how long a consistent view of the
index should be maintained for scrolled search, e.g., "30s", "1m". See
<a href='units-time.html'>units-time</a></p></td>
    </tr>
    <tr>
      <th>search_path</th>
      <td><p>(character) The path to use for searching. Default
to <code>_search</code>, but in some cases you may already have that in the base
url set using <code><a href='connect.html'>connect()</a></code>, in which case you can set this
to <code>NULL</code></p></td>
    </tr>
    <tr>
      <th>stream_opts</th>
      <td><p>(list) A list of options passed to
<code><a href='https://www.rdocumentation.org/packages/jsonlite/topics/stream_in'>stream_out</a></code> - Except that you can't pass <code>x</code> as
that's the data that's streamed out, and pass a file path instead of a
connection to <code>con</code>. <code>pagesize</code> param doesn't do much as
that's more or less controlled by paging with ES.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Curl args passed on to <code><a href='https://www.rdocumentation.org/packages/crul/topics/verb-POST'>verb-POST</a></code></p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function name has the "S" capitalized to avoid conflict with the function
<code><a href='https://www.rdocumentation.org/packages/base/topics/search'>base::search</a></code>. I hate mixing cases, as I think it confuses users, but in this case
it seems neccessary.</p>
    
    <h2 class="hasAnchor" id="profile"><a class="anchor" href="#profile"></a>profile</h2>

    
    <p>The Profile API provides detailed timing information about the execution of
individual components in a search request. See
https://www.elastic.co/guide/en/elasticsearch/reference/current/search-profile.html
for more information</p>
<p>In a body query, you can set to <code>profile: true</code> to enable profiling
results. e.g.</p>
<pre>
{
  "profile": true,
  "query" : {
    "match" : { "message" : "some number" }
  }
}
</pre>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><a href='https://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html'>https://www.elastic.co/guide/en/elasticsearch/reference/current/search-search.html</a>
<a href='https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html'>https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html</a></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='Search_uri.html'>Search_uri()</a></code> <code><a href='Search_template.html'>Search_template()</a></code> <code><a href='scroll.html'>scroll()</a></code> <code><a href='count.html'>count()</a></code>
<code><a href='validate.html'>validate()</a></code> <code><a href='fielddata.html'>fielddata()</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># make connection object</span>
(<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='connect.html'>connect</a></span>())

<span class='co'># load some data</span>
<span class='kw'>if</span> (!<span class='fu'><a href='indices.html'>index_exists</a></span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>)) {
  <span class='no'>shakespeare</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"examples"</span>, <span class='st'>"shakespeare_data.json"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"elastic"</span>)
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/invisible'>invisible</a></span>(<span class='fu'><a href='docs_bulk.html'>docs_bulk</a></span>(<span class='no'>x</span>, <span class='no'>shakespeare</span>))
}
<span class='kw'>if</span> (!<span class='fu'><a href='indices.html'>index_exists</a></span>(<span class='no'>x</span>, <span class='st'>"gbif"</span>)) {
  <span class='no'>gbif</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"examples"</span>, <span class='st'>"gbif_data.json"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"elastic"</span>)
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/invisible'>invisible</a></span>(<span class='fu'><a href='docs_bulk.html'>docs_bulk</a></span>(<span class='no'>x</span>, <span class='no'>gbif</span>))
}
<span class='kw'>if</span> (!<span class='fu'><a href='indices.html'>index_exists</a></span>(<span class='no'>x</span>, <span class='st'>"plos"</span>)) {
  <span class='no'>plos</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"examples"</span>, <span class='st'>"plos_data.json"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"elastic"</span>)
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/invisible'>invisible</a></span>(<span class='fu'><a href='docs_bulk.html'>docs_bulk</a></span>(<span class='no'>x</span>, <span class='no'>plos</span>))
}


<span class='co'># URI string queries</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>)
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"act"</span>)
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"scene"</span>)
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"line"</span>)

<span class='co'>## Return certain fields</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
  <span class='co'>### ES &lt; v5</span>
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>fields</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>'play_name'</span>,<span class='st'>'speaker'</span>))
} <span class='kw'>else</span> {
  <span class='co'>### ES &gt; v5</span>
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='st'>'{
   "_source": ["play_name", "speaker"]
  }'</span>)
}

<span class='co'>## Search multiple indices</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"gbif"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"shakespeare"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"gbif"</span>, <span class='st'>"shakespeare"</span>))$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>## search_type</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>search_type</span> <span class='kw'>=</span> <span class='st'>"query_then_fetch"</span>)
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>search_type</span> <span class='kw'>=</span> <span class='st'>"dfs_query_then_fetch"</span>)
<span class='co'>### search type "scan" is gone - use time_scroll instead</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>time_scroll</span> <span class='kw'>=</span> <span class='st'>"2m"</span>)
<span class='co'>### search type "count" is gone - use size=0 instead</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>0</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>## search exists check</span>
<span class='co'>### use size set to 0 and terminate_after set to 1</span>
<span class='co'>### if there are &gt; 0 hits, then there are matching documents</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"act"</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>terminate_after</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='co'>## sorting</span>
<span class='co'>### if ES &gt;5, we need to make sure fielddata is turned on for a field </span>
<span class='co'>### before using it for sort </span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&gt;=</span> <span class='fl'>500</span>) {
  <span class='fu'><a href='mapping.html'>mapping_create</a></span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='st'>"line"</span>, <span class='kw'>update_all_types</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='st'>'{
    "properties": {
      "speaker": { 
      "type":     "text",
      "fielddata": true
    }
  }
 }'</span>)
 <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"line"</span>, <span class='kw'>sort</span><span class='kw'>=</span><span class='st'>"speaker"</span>)
}

<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"line"</span>, <span class='kw'>sort</span><span class='kw'>=</span><span class='st'>"speaker:desc"</span>,
    <span class='kw'>fields</span><span class='kw'>=</span><span class='st'>'speaker'</span>)
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"line"</span>,
    <span class='kw'>sort</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"speaker:desc"</span>,<span class='st'>"play_name:asc"</span>), <span class='kw'>fields</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>'speaker'</span>,<span class='st'>'play_name'</span>))
}


<span class='co'>## paging</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>1</span>)$<span class='no'>hits</span>$<span class='no'>hits</span>
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>from</span><span class='kw'>=</span><span class='fl'>1</span>)$<span class='no'>hits</span>$<span class='no'>hits</span>
}

<span class='co'>## queries</span>
<span class='co'>### Search in all fields</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"act"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"york"</span>)

<span class='co'>### Searchin specific fields</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"act"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"speaker:KING HENRY IV"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### Exact phrase search by wrapping in quotes</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"act"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>'speaker:"KING HENRY IV"'</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### can specify operators between multiple words parenthetically</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"act"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"speaker:(HENRY OR ARCHBISHOP)"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### where the field line_number has no value (or is missing)</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"_missing_:line_number"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### where the field line_number has any non-null value</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"_exists_:line_number"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### wildcards, either * or ?</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"*ay"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"m?y"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### regular expressions, wrapped in forward slashes</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"text_entry:/[a-z]/"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### fuzziness</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"text_entry:ma~"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"text_entry:the~2"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"text_entry:the~1"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### Proximity searches</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>'text_entry:"as hath"~5'</span>)$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>'text_entry:"as hath"~10'</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### Ranges, here where line_id value is between 10 and 20</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"line_id:[10 TO 20]"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>### Grouping</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"(hath OR as) AND the"</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'># Limit number of hits returned with the size parameter</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>1</span>)

<span class='co'># Give explanation of search in result</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>explain</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'>## terminate query after x documents found</span>
<span class='co'>## setting to 1 gives back one document for each shard</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>terminate_after</span><span class='kw'>=</span><span class='fl'>1</span>)
<span class='co'>## or set to other number</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>terminate_after</span><span class='kw'>=</span><span class='fl'>2</span>)

<span class='co'>## Get version number for each document</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>version</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>2</span>)

<span class='co'>## Get raw data</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"scene"</span>, <span class='kw'>raw</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'>## Curl options </span>
<span class='co'>### verbose </span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"line"</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)


<span class='co'># Query DSL searches - queries sent in the body of the request</span>
<span class='co'>## Pass in as an R list</span>

<span class='co'>### if ES &gt;5, we need to make sure fielddata is turned on for a field </span>
<span class='co'>### before using it for aggregations </span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&gt;=</span> <span class='fl'>500</span>) {
  <span class='fu'><a href='mapping.html'>mapping_create</a></span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='st'>"line"</span>, <span class='kw'>update_all_types</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='st'>'{
    "properties": {
      "text_entry": { 
        "type":     "text",
        "fielddata": true
     }
   }
 }'</span>)
 <span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>aggs</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>stats</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>terms</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>field</span> <span class='kw'>=</span> <span class='st'>"text_entry"</span>))))
 <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>)
}

<span class='co'>### if ES &gt;5, you don't need to worry about fielddata</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
   <span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>aggs</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>stats</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>terms</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>field</span> <span class='kw'>=</span> <span class='st'>"text_entry"</span>))))
   <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>)
}

<span class='co'>## or pass in as json query with newlines, easy to read</span>
<span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='st'>'{
    "aggs": {
        "stats" : {
            "terms" : {
                "field" : "speaker"
            }
        }
    }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>, <span class='kw'>asdf</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>0</span>)

<span class='co'>## or pass in collapsed json string</span>
<span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='st'>'{"aggs":{"stats":{"terms":{"field":"text_entry"}}}}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>)


<span class='co'>## Aggregations</span>
<span class='co'>### Histograms</span>
<span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='st'>'{
    "aggs": {
        "latbuckets" : {
           "histogram" : {
               "field" : "decimalLatitude",
               "interval" : 5
           }
        }
    }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"gbif"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>0</span>)

<span class='co'>### Histograms w/ more options</span>
<span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='st'>'{
    "aggs": {
        "latbuckets" : {
           "histogram" : {
               "field" : "decimalLatitude",
               "interval" : 5,
               "min_doc_count" : 0,
               "extended_bounds" : {
                   "min" : -90,
                   "max" : 90
               }
           }
        }
    }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"gbif"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>0</span>)

<span class='co'>### Ordering the buckets by their doc_count - ascending:</span>
<span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='st'>'{
    "aggs": {
        "latbuckets" : {
           "histogram" : {
               "field" : "decimalLatitude",
               "interval" : 5,
               "min_doc_count" : 0,
               "extended_bounds" : {
                   "min" : -90,
                   "max" : 90
               },
               "order" : {
                   "_count" : "desc"
               }
           }
        }
    }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"gbif"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>0</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>out</span>$<span class='no'>aggregations</span>$<span class='no'>latbuckets</span>$<span class='no'>buckets</span>, <span class='no'>data.frame</span>)

<span class='co'>### By default, the buckets are returned as an ordered array. It is also possible to</span>
<span class='co'>### request the response as a hash instead keyed by the buckets keys:</span>
<span class='no'>aggs</span> <span class='kw'>&lt;-</span> <span class='st'>'{
    "aggs": {
        "latbuckets" : {
           "histogram" : {
               "field" : "decimalLatitude",
               "interval" : 10,
               "keyed" : true
           }
        }
    }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"gbif"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>aggs</span>, <span class='kw'>size</span><span class='kw'>=</span><span class='fl'>0</span>)

<span class='co'># match query</span>
<span class='no'>match</span> <span class='kw'>&lt;-</span> <span class='st'>'{"query": {"match" : {"text_entry" : "Two Gentlemen"}}}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>match</span>)

<span class='co'># multi-match (multiple fields that is) query</span>
<span class='no'>mmatch</span> <span class='kw'>&lt;-</span> <span class='st'>'{"query": {"multi_match" : {"query" : "henry", "fields": ["text_entry","play_name"]}}}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>mmatch</span>)

<span class='co'># bool query</span>
<span class='no'>mmatch</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query": {
   "bool" : {
     "must_not" : {
       "range" : {
         "speech_number" : {
           "from" : 1, "to": 5
}}}}}}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>mmatch</span>)

<span class='co'># Boosting query</span>
<span class='no'>boost</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query" : {
  "boosting" : {
      "positive" : {
          "term" : {
              "play_name" : "henry"
          }
      },
      "negative" : {
          "term" : {
              "text_entry" : "thou"
          }
      },
      "negative_boost" : 0.8
    }
 }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>boost</span>)

<span class='co'># Fuzzy query</span>
<span class='co'>## fuzzy query on numerics</span>
<span class='no'>fuzzy</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>query</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>fuzzy</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>text_entry</span> <span class='kw'>=</span> <span class='st'>"arms"</span>)))
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>fuzzy</span>)$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='no'>fuzzy</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>query</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>fuzzy</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>text_entry</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"arms"</span>, <span class='kw'>fuzziness</span> <span class='kw'>=</span> <span class='fl'>4</span>))))
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>"shakespeare"</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>fuzzy</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'># geoshape query</span>
<span class='co'>## not working yets</span>
<span class='no'>geo</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>query</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>geo_shape</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>location</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>shape</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"envelope"</span>,
   <span class='kw'>coordinates</span> <span class='kw'>=</span> <span class='st'>"[[2,10],[10,20]]"</span>)))))
<span class='no'>geo</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query": {
   "geo_shape": {
     "location": {
       "point": {
         "type": "envelope",
         "coordinates": [[2,0],[2.93,100]]
       }
     }
   }
 }
}'</span>
<span class='co'># Search(x, index="gbifnewgeo", body=geo)</span>

<span class='co'># range query</span>
<span class='co'>## with numeric</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>query</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>range</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>decimalLongitude</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>gte</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>lte</span><span class='kw'>=</span><span class='fl'>3</span>))))
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbif'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>query</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>range</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>decimalLongitude</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>gte</span><span class='kw'>=</span><span class='fl'>2.9</span>, <span class='kw'>lte</span><span class='kw'>=</span><span class='fl'>10</span>))))
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbif'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>## with dates</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>query</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>range</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>eventDate</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>gte</span><span class='kw'>=</span><span class='st'>"2012-01-01"</span>, <span class='kw'>lte</span><span class='kw'>=</span><span class='st'>"now"</span>))))
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbif'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>query</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>range</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>eventDate</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>gte</span><span class='kw'>=</span><span class='st'>"2014-01-01"</span>, <span class='kw'>lte</span><span class='kw'>=</span><span class='st'>"now"</span>))))
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbif'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'># more like this query (more_like_this can be shortened to mlt)</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query": {
   "more_like_this": {
     "fields": ["title"],
     "like": "and then",
     "min_term_freq": 1,
     "max_query_terms": 12
   }
 }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'plos'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query": {
   "more_like_this": {
     "fields": ["abstract","title"],
     "like": "cell",
     "min_term_freq": 1,
     "max_query_terms": 12
   }
 }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'plos'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'># Highlighting</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query": {
   "query_string": {
     "query" : "cell"
   }
 },
 "highlight": {
   "fields": {
     "title": {"number_of_fragments": 2}
   }
 }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'plos'</span>, <span class='st'>'article'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>sapply</a></span>(<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>`_source`</span>$<span class='no'>title</span><span class='kw'>[[</span><span class='fl'>1</span>]])

<span class='co'>### Common terms query</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query" : {
   "common": {
      "body": {
           "query": "this is",
           "cutoff_frequency": 0.01
       }
     }
  }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'shakespeare'</span>, <span class='st'>'line'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)

<span class='co'>## Scrolling search - instead of paging</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>'shakespeare'</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"a*"</span>, <span class='kw'>time_scroll</span><span class='kw'>=</span><span class='st'>"1m"</span>)
<span class='fu'><a href='scroll.html'>scroll</a></span>(<span class='no'>x</span>, <span class='no'>res</span>$<span class='no'>`_scroll_id`</span>)

<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>'shakespeare'</span>, <span class='kw'>q</span><span class='kw'>=</span><span class='st'>"a*"</span>, <span class='kw'>time_scroll</span><span class='kw'>=</span><span class='st'>"5m"</span>)
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>()
<span class='no'>hits</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='kw'>while</span>(<span class='no'>hits</span> <span class='kw'>!=</span> <span class='fl'>0</span>){
  <span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='scroll.html'>scroll</a></span>(<span class='no'>x</span>, <span class='no'>res</span>$<span class='no'>`_scroll_id`</span>)
  <span class='no'>hits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>res</span>$<span class='no'>hits</span>$<span class='no'>hits</span>)
  <span class='kw'>if</span>(<span class='no'>hits</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>)
    <span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='no'>out</span>, <span class='no'>res</span>$<span class='no'>hits</span>$<span class='no'>hits</span>)
}

<span class='co'>### Sliced scrolling</span>
<span class='co'>#### For scroll queries that return a lot of documents it is possible to </span>
<span class='co'>#### split the scroll in multiple slices which can be consumed independently</span>
<span class='no'>body1</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "slice": {
    "id": 0, 
    "max": 2 
  },
  "query": {
    "match" : {
      "text_entry" : "a*"
    }
  }
}'</span>

<span class='no'>body2</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "slice": {
    "id": 1, 
    "max": 2 
  },
  "query": {
    "match" : {
      "text_entry" : "a*"
    }
  }
}'</span>

<span class='no'>res1</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>'shakespeare'</span>, <span class='kw'>time_scroll</span><span class='kw'>=</span><span class='st'>"1m"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body1</span>)
<span class='no'>res2</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>'shakespeare'</span>, <span class='kw'>time_scroll</span><span class='kw'>=</span><span class='st'>"1m"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body2</span>)
<span class='fu'><a href='scroll.html'>scroll</a></span>(<span class='no'>x</span>, <span class='no'>res1</span>$<span class='no'>`_scroll_id`</span>)
<span class='fu'><a href='scroll.html'>scroll</a></span>(<span class='no'>x</span>, <span class='no'>res2</span>$<span class='no'>`_scroll_id`</span>)

<span class='no'>out1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>()
<span class='no'>hits</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='kw'>while</span>(<span class='no'>hits</span> <span class='kw'>!=</span> <span class='fl'>0</span>){
  <span class='no'>tmp1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='scroll.html'>scroll</a></span>(<span class='no'>x</span>, <span class='no'>res1</span>$<span class='no'>`_scroll_id`</span>)
  <span class='no'>hits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>tmp1</span>$<span class='no'>hits</span>$<span class='no'>hits</span>)
  <span class='kw'>if</span>(<span class='no'>hits</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>)
    <span class='no'>out1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='no'>out1</span>, <span class='no'>tmp1</span>$<span class='no'>hits</span>$<span class='no'>hits</span>)
}

<span class='no'>out2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>()
<span class='no'>hits</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='kw'>while</span>(<span class='no'>hits</span> <span class='kw'>!=</span> <span class='fl'>0</span>) {
  <span class='no'>tmp2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='scroll.html'>scroll</a></span>(<span class='no'>x</span>, <span class='no'>res2</span>$<span class='no'>`_scroll_id`</span>)
  <span class='no'>hits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>tmp2</span>$<span class='no'>hits</span>$<span class='no'>hits</span>)
  <span class='kw'>if</span>(<span class='no'>hits</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>)
    <span class='no'>out2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='no'>out2</span>, <span class='no'>tmp2</span>$<span class='no'>hits</span>$<span class='no'>hits</span>)
}

<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(
 <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>out1</span>, <span class='st'>"[["</span>, <span class='st'>"_source"</span>),
 <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>out2</span>, <span class='st'>"[["</span>, <span class='st'>"_source"</span>)
)



<span class='co'># Using filters</span>
<span class='co'>## A bool filter</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query":{
   "bool": {
     "must_not" : {
       "range" : {
         "year" : { "from" : 2011, "to" : 2012 }
       }
     }
   }
 }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbif'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>## Geo filters - fun!</span>
<span class='co'>### Note that filers have many geospatial filter options, but queries </span>
<span class='co'>### have fewer, andrequire a geo_shape mapping</span>

<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "mappings": {
   "record": {
     "properties": {
         "location" : {"type" : "geo_point"}
      }
   }
 }
}'</span>
<span class='fu'><a href='indices.html'>index_recreate</a></span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>'gbifgeopoint'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)
<span class='no'>path</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"examples"</span>, <span class='st'>"gbif_geopoint.json"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"elastic"</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/invisible'>invisible</a></span>(<span class='fu'><a href='docs_bulk.html'>docs_bulk</a></span>(<span class='no'>x</span>, <span class='no'>path</span>))

<span class='co'>### Points within a bounding box</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query":{
   "bool" : {
     "must" : {
       "match_all" : {}
     },
     "filter":{
        "geo_bounding_box" : {
          "location" : {
            "top_left" : {
              "lat" : 60,
              "lon" : 1
            },
            "bottom_right" : {
              "lat" : 40,
              "lon" : 14
            }
          }
       }
     }
   }
 }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbifgeopoint'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>300</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/do.call'>do.call</a></span>(<span class='no'>rbind</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>`_source`</span>$<span class='no'>location</span>))

<span class='co'>### Points within distance of a point</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
"query": {
  "bool" : {
    "must" : {
      "match_all" : {}
    },
   "filter" : {
     "geo_distance" : {
       "distance" : "200km",
       "location" : {
         "lon" : 4,
         "lat" : 50
       }
     }
  }
}}}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbifgeopoint'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/do.call'>do.call</a></span>(<span class='no'>rbind</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>`_source`</span>$<span class='no'>location</span>))

<span class='co'>### Points within distance range of a point</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "aggs":{
   "points_within_dist" : {
     "geo_distance" : {
        "field": "location",
        "origin" : "4, 50",
        "ranges": [ 
          {"from" : 200},
          {"to" : 400}
         ]
     }
   }
 }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbifgeopoint'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/do.call'>do.call</a></span>(<span class='no'>rbind</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>`_source`</span>$<span class='no'>location</span>))

<span class='co'>### Points within a polygon</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query":{
   "bool" : {
     "must" : {
       "match_all" : {}
     },
     "filter":{
        "geo_polygon" : {
          "location" : {
             "points" : [
               [80.0, -20.0], [-80.0, -20.0], [-80.0, 60.0], [40.0, 60.0], [80.0, -20.0]
             ]
           }
         }
       }
     }
   }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbifgeopoint'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/do.call'>do.call</a></span>(<span class='no'>rbind</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>lapply</a></span>(<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span>$<span class='no'>`_source`</span>$<span class='no'>location</span>))

<span class='co'>### Geoshape filters using queries instead of filters</span>
<span class='co'>#### Get data with geojson type location data loaded first</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "mappings": {
   "record": {
     "properties": {
         "location" : {"type" : "geo_shape"}
      }
   }
 }
}'</span>
<span class='fu'><a href='indices.html'>index_recreate</a></span>(<span class='no'>x</span>, <span class='kw'>index</span><span class='kw'>=</span><span class='st'>'geoshape'</span>, <span class='kw'>body</span><span class='kw'>=</span><span class='no'>body</span>)
<span class='no'>path</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"examples"</span>, <span class='st'>"gbif_geoshape.json"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"elastic"</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/invisible'>invisible</a></span>(<span class='fu'><a href='docs_bulk.html'>docs_bulk</a></span>(<span class='no'>x</span>, <span class='no'>path</span>))

<span class='co'>#### Get data with a square envelope, w/ point defining upper left and the other</span>
<span class='co'>#### defining the lower right</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query":{
   "geo_shape" : {
     "location" : {
         "shape" : {
           "type": "envelope",
            "coordinates": [[-30, 50],[30, 0]]
         }
       }
     }
   }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'geoshape'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>#### Get data with a circle, w/ point defining center, and radius</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query":{
   "geo_shape" : {
     "location" : {
         "shape" : {
           "type": "circle",
           "coordinates": [-10, 45],
           "radius": "2000km"
         }
       }
     }
   }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'geoshape'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>

<span class='co'>#### Use a polygon, w/ point defining center, and radius</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query":{
   "geo_shape" : {
     "location" : {
         "shape" : {
           "type": "polygon",
           "coordinates":  [
              [ [80.0, -20.0], [-80.0, -20.0], [-80.0, 60.0], [40.0, 60.0], [80.0, -20.0] ]
           ]
         }
       }
     }
   }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'geoshape'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>


<span class='co'># Geofilter with WKT</span>
<span class='co'># format follows "BBOX (minlon, maxlon, maxlat, minlat)"</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
    "query": {
        "bool" : {
            "must" : {
                "match_all" : {}
            },
            "filter" : {
                "geo_bounding_box" : {
                    "location" : {
                        "wkt" : "BBOX (1, 14, 60, 40)"
                    }
                }
            }
        }
    }
}'</span>
<span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>'gbifgeopoint'</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>out</span>$<span class='no'>hits</span>$<span class='no'>total</span>



<span class='co'># Missing filter</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
  <span class='co'>### ES &lt; v5</span>
  <span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
   "query":{
     "constant_score" : {
       "filter" : {
         "missing" : { "field" : "play_name" }
       }
     }
    }
  }'</span>
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
} <span class='kw'>else</span> {
  <span class='co'>### ES =&gt; v5</span>
  <span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
   "query":{
     "bool" : {
       "must_not" : {
         "exists" : { 
           "field" : "play_name" 
         }
       }
    }
   }
  }'</span>
  <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
}

<span class='co'># prefix filter</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query": {
   "bool": {
     "must": {
       "prefix" : {
         "speaker" : "we"
       }
     }
   }
 }
}'</span>
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>total</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>vapply</a></span>(<span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='st'>"[["</span>, <span class='st'>""</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"_source"</span>, <span class='st'>"speaker"</span>))


<span class='co'># ids filter</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
  <span class='co'>### ES &lt; v5</span>
  <span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
   "query":{
     "bool": {
       "must": {
         "ids" : {
           "values": ["1","2","10","2000"]
        }
      }
    }
   }
  }'</span>
  <span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
  <span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>total</span>
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/identical'>identical</a></span>(
   <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"1"</span>,<span class='st'>"2"</span>,<span class='st'>"10"</span>,<span class='st'>"2000"</span>),
   <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>vapply</a></span>(<span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='st'>"[["</span>, <span class='st'>""</span>, <span class='st'>"_id"</span>)
  )
} <span class='kw'>else</span> {
  <span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
   "query":{
     "ids" : {
       "values": ["1","2","10","2000"]
     }
   }
  }'</span>
  <span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
  <span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>total</span>
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/identical'>identical</a></span>(
   <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"2000"</span>,<span class='st'>"10"</span>,<span class='st'>"2"</span>,<span class='st'>"1"</span>),
   <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>vapply</a></span>(<span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>hits</span>, <span class='st'>"[["</span>, <span class='st'>""</span>, <span class='st'>"_id"</span>)
  )
}

<span class='co'># combined prefix and ids filters</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>gsub</a></span>(<span class='st'>"\\."</span>, <span class='st'>""</span>, <span class='no'>x</span>$<span class='fu'><a href='ping.html'>ping</a></span>()$<span class='no'>version</span>$<span class='no'>number</span>) <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
  <span class='co'>### ES &lt; v5</span>
  <span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
   "query":{
     "bool" : {
       "should" : {
         "or": [{
           "ids" : {
             "values": ["1","2","3","10","2000"]
           }
         }, {
         "prefix" : {
           "speaker" : "we"
         }
        }
      ]
     }
    }
   }
  }'</span>
  <span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
  <span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>total</span>
} <span class='kw'>else</span> {
  <span class='co'>### ES =&gt; v5</span>
  <span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
   "query":{
     "bool" : {
       "should" : [
         {
           "ids" : {
             "values": ["1","2","3","10","2000"]
           }
         }, 
         {
           "prefix" : {
             "speaker" : "we"
           }
         }
      ]
     }
    }
  }'</span>
  <span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
  <span class='no'>z</span>$<span class='no'>hits</span>$<span class='no'>total</span>
}

<span class='co'># Suggestions</span>
<span class='no'>sugg</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query" : {
    "match" : {
      "text_entry" : "late"
     }
 },  
 "suggest" : {
   "sugg" : {
     "text" : "late",
     "term" : {
         "field" : "text_entry"
      }
    }
  }
}'</span>
<span class='fu'>Search</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"shakespeare"</span>, <span class='st'>"line"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>sugg</span>,
  <span class='kw'>asdf</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>0</span>)$<span class='no'>suggest</span>$<span class='no'>sugg</span>$<span class='no'>options</span>



<span class='co'># stream data out using jsonlite::stream_out</span>
<span class='no'>file</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/tempfile'>tempfile</a></span>()
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>stream_opts</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>file</span> <span class='kw'>=</span> <span class='no'>file</span>))
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/head'>head</a></span>(<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>jsonlite</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/jsonlite/topics/stream_in'>stream_in</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/connections'>file</a></span>(<span class='no'>file</span>)))
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>NROW</a></span>(<span class='no'>df</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/unlink'>unlink</a></span>(<span class='no'>file</span>)


<span class='co'># get profile data</span>
<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "profile": true,
  "query" : {
    "match" : { "text_entry" : "war" }
  }
}'</span>
<span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='fu'>Search</span>(<span class='no'>x</span>, <span class='st'>"shakespeare"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)
<span class='no'>res</span>$<span class='no'>profile</span>
<span class='co'># time in nanoseconds across each of the shards</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>vapply</a></span>(<span class='no'>res</span>$<span class='no'>profile</span>$<span class='no'>shards</span>, <span class='kw'>function</span>(<span class='no'>w</span>) {
  <span class='no'>w</span>$<span class='no'>searches</span><span class='kw'>[[</span><span class='fl'>1</span>]]$<span class='no'>query</span><span class='kw'>[[</span><span class='fl'>1</span>]]$<span class='no'>time_in_nanos</span>
}, <span class='fl'>1</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#profile">profile</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Scott Chamberlain.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

