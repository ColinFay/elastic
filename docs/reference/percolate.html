<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Percolater — percolate • elastic</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Percolater — percolate" />

<meta property="og:description" content="Store queries into an index then, via the percolate API, define
documents to retrieve these queries." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">elastic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/elastic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/search.html">UNKNOWN TITLE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/elastic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Percolater</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/elastic/blob/master/R/percolater.R'><code>R/percolater.R</code></a></small>
    <div class="hidden name"><code>percolate.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Store queries into an index then, via the percolate API, define
documents to retrieve these queries.</p>
    
    </div>

    <pre class="usage"><span class='fu'>percolate_register</span>(<span class='no'>conn</span>, <span class='no'>index</span>, <span class='no'>type</span>, <span class='no'>id</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(),
  <span class='kw'>routing</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>preference</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ignore_unavailable</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>percolate_format</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>refresh</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>percolate_match</span>(<span class='no'>conn</span>, <span class='no'>index</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>body</span>, <span class='kw'>routing</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>preference</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ignore_unavailable</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>percolate_format</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>percolate_list</span>(<span class='no'>conn</span>, <span class='no'>index</span>, <span class='no'>...</span>)

<span class='fu'>percolate_count</span>(<span class='no'>conn</span>, <span class='no'>index</span>, <span class='no'>type</span>, <span class='no'>body</span>, <span class='no'>...</span>)

<span class='fu'>percolate_delete</span>(<span class='no'>conn</span>, <span class='no'>index</span>, <span class='no'>id</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>conn</th>
      <td><p>an Elasticsearch connection object, see <code><a href='connect.html'>connect()</a></code></p></td>
    </tr>
    <tr>
      <th>index</th>
      <td><p>Index name. Required</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Document type. Required</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>A precolator id. Required</p></td>
    </tr>
    <tr>
      <th>body</th>
      <td><p>Body json, or R list.</p></td>
    </tr>
    <tr>
      <th>routing</th>
      <td><p>(character) In case the percolate queries are partitioned by a custom
routing value, that routing option makes sure that the percolate request only gets
executed on the shard where the routing value is partitioned to. This means that the
percolate request only gets executed on one shard instead of all shards. Multiple values
can be specified as a comma separated string, in that case the request can be be executed
on more than one shard.</p></td>
    </tr>
    <tr>
      <th>preference</th>
      <td><p>(character) Controls which shard replicas are preferred to execute
the request on. Works the same as in the search API.</p></td>
    </tr>
    <tr>
      <th>ignore_unavailable</th>
      <td><p>(logical) Controls if missing concrete indices should
silently be ignored. Same as is in the search API.</p></td>
    </tr>
    <tr>
      <th>percolate_format</th>
      <td><p>(character) If ids is specified then the matches array in the
percolate response will contain a string array of the matching ids instead of an
array of objects. This can be useful to reduce the amount of data being send back to
the client. Obviously if there are two percolator queries with same id from different
indices there is no way to find out which percolator query belongs to what index. Any
other value to percolate_format will be ignored.</p></td>
    </tr>
    <tr>
      <th>refresh</th>
      <td><p>If <code>TRUE</code> then refresh the affected shards to make this
operation visible to search, if "wait_for" then wait for a refresh to
make this operation visible to search, if <code>FALSE</code> (default) then do
nothing with refreshes. Valid choices: <code>TRUE</code>, <code>FALSE</code>, "wait_for"</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Curl options. Or in <code>percolate_list</code> function, further args
passed on to <code><a href='Search.html'>Search()</a></code></p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Additional body options, pass those in the body. These aren't query string
parameters:</p><ul>
<li><p>filter - Reduces the number queries to execute during percolating. Only the
percolator queries that match with the filter will be included in the percolate
execution. The filter option works in near realtime, so a refresh needs to have
occurred for the filter to included the latest percolate queries.</p></li>
<li><p>query - Same as the filter option, but also the score is computed. The
computed scores can then be used by the track_scores and sort option.</p></li>
<li><p>size - Defines to maximum number of matches (percolate queries) to be returned.
Defaults to unlimited.</p></li>
<li><p>track_scores - Whether the _score is included for each match. The _score is
based on the query and represents how the query matched the percolate query's
metadata, not how the document (that is being percolated) matched the query. The query
option is required for this option. Defaults to false.</p></li>
<li><p>sort - Define a sort specification like in the search API. Currently only
sorting _score reverse (default relevancy) is supported. Other sort fields will
throw an exception. The size and query option are required for this setting. Like
track_score the score is based on the query and represents how the query matched
to the percolate query's metadata and not how the document being percolated matched
to the query.</p></li>
<li><p>aggs - Allows aggregation definitions to be included. The aggregations are
based on the matching percolator queries, look at the aggregation documentation on
how to define aggregations.</p></li>
<li><p>highlight - Allows highlight definitions to be included. The document being
percolated is being highlight for each matching query. This allows you to see how
each match is highlighting the document being percolated. See highlight documentation
on how to define highlights. The size option is required for highlighting, the
performance of highlighting in the percolate API depends of how many matches are
being highlighted.</p></li>
</ul>
    
    <h2 class="hasAnchor" id="the-elasticsearch-v-split"><a class="anchor" href="#the-elasticsearch-v-split"></a>The Elasticsearch v5 split</h2>

    
    <p>In Elasticsearch &lt; v5, there's a certain set of percolate APIs available,
while in Elasticsearch &gt;= v5, there's a different set of APIs available.</p>
<p>Internally within these percolate functions we detect your Elasticsearch
version, then use the appropriate APIs</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><a href='https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-percolate-query.html'>https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-percolate-query.html</a></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='connect.html'>connect</a></span>(<span class='kw'>errors</span> <span class='kw'>=</span> <span class='st'>"complete"</span>)

<span class='co'>##### Elasticsearch &lt; v5</span>
<span class='kw'>if</span> (<span class='no'>x</span>$<span class='fu'>es_ver</span>() <span class='kw'>&lt;</span> <span class='fl'>500</span>) {
<span class='co'># typical usage</span>
<span class='co'>## create an index first</span>
<span class='kw'>if</span> (<span class='fu'><a href='indices.html'>index_exists</a></span>(<span class='no'>x</span>, <span class='st'>"myindex"</span>)) <span class='fu'><a href='indices.html'>index_delete</a></span>(<span class='no'>x</span>, <span class='st'>"myindex"</span>)
<span class='no'>mapping</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "mappings": {
    "mytype": {
      "properties": {
        "message": {
           "type": "text"
        },
        "query": {
           "type": "percolator"
        }
      }
    }
  }
}'</span>
<span class='fu'><a href='indices.html'>index_create</a></span>(<span class='no'>x</span>, <span class='st'>"myindex"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>mapping</span>)

<span class='co'>## register a percolator</span>
<span class='no'>perc_body</span> <span class='kw'>=</span> <span class='st'>'{
 "query" : {
    "match" : {
      "message" : "bonsai tree"
    }
 }
}'</span>
<span class='fu'>percolate_register</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"mytype"</span>,
  <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>perc_body</span>)

<span class='co'>## register another</span>
<span class='no'>perc_body2</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "query" : {
    "match" : {
      "message" : "jane doe"
    }
  }
}'</span>
<span class='fu'>percolate_register</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"mytype"</span>,
  <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>perc_body2</span>)

<span class='co'>## match a document to a percolator</span>
<span class='no'>doc</span> <span class='kw'>&lt;-</span> <span class='st'>'{
 "query": {
   "percolate": {
     "field": "query",
     "document": {
       "message" : "A new bonsai tree in the office"
     }
   }
 }
}'</span>
<span class='fu'>percolate_match</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"mytype"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>doc</span>)

<span class='co'>## List percolators - for an index, no type, can't do across indices</span>
<span class='fu'>percolate_list</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>)$<span class='no'>hits</span>$<span class='no'>hits</span>

<span class='co'>## Percolate counter</span>
<span class='fu'>percolate_count</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"mytype"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>doc</span>)$<span class='no'>total</span>

<span class='co'>## delete a percolator</span>
<span class='fu'>percolate_delete</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>2</span>)
} <span class='co'># end ES &lt; 5</span>


<span class='co'>##### Elasticsearch &gt;= v5</span>
<span class='kw'>if</span> (<span class='no'>x</span>$<span class='fu'>es_ver</span>() <span class='kw'>&gt;=</span> <span class='fl'>500</span>) {
<span class='kw'>if</span> (<span class='fu'><a href='indices.html'>index_exists</a></span>(<span class='no'>x</span>, <span class='st'>"myindex"</span>)) <span class='fu'><a href='indices.html'>index_delete</a></span>(<span class='no'>x</span>, <span class='st'>"myindex"</span>)

<span class='no'>body</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "mappings": {
    "mytype": {
      "properties": {
        "message": {
           "type": "text"
        },
        "query": {
           "type": "percolator"
        }
      }
    }
  }
}'</span>

<span class='co'># create the index with mapping</span>
<span class='fu'><a href='indices.html'>index_create</a></span>(<span class='no'>x</span>, <span class='st'>"myindex"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>body</span>)

<span class='co'>## register a percolator</span>
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "query" : {
     "match" : {
       "message" : "bonsai tree"
     }
  }
}'</span>
<span class='fu'>percolate_register</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"mytype"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>z</span>)

<span class='co'>## register another</span>
<span class='no'>x2</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "query" : {
    "match" : {
      "message" : "the office"
    }
  }
}'</span>
<span class='fu'>percolate_register</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"mytype"</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>x2</span>)

<span class='co'>## match a document to a percolator</span>
<span class='no'>query</span> <span class='kw'>&lt;-</span> <span class='st'>'{
  "query" : {
    "percolate" : {
      "field": "query",
      "document": {
        "message": "A new bonsai tree in the office"
      }
    }
  }
}'</span>
<span class='fu'>percolate_match</span>(<span class='no'>x</span>, <span class='kw'>index</span> <span class='kw'>=</span> <span class='st'>"myindex"</span>, <span class='kw'>body</span> <span class='kw'>=</span> <span class='no'>query</span>)
} <span class='co'># end ES &gt;= 5</span>


<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#the-elasticsearch-v-split">The Elasticsearch v5 split</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Scott Chamberlain.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

